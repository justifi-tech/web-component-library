import {
  Meta,
  Title,
  Subtitle,
  Description,
  ArgTypes,
  Source,
} from '@storybook/blocks';
import { filterDocsByTag, ExportedParts } from '../../utils';
import { codeExample } from './example';
import { ComponentBox } from '../../utils/documentation-components';
import * as JustifiCheckoutWrapper from './index.stories.tsx';
import { setUpMocks } from '../../utils/mockAllServices';

{setUpMocks()}

<Meta
  title="Modular Checkout/Checkout Wrapper"
  Components="justifi-checkout-wrapper"
  of={JustifiCheckoutWrapper}
/>

<Title />

---

The `checkout-wrapper` component serves as a container for checkout-related subcomponents. It manages the tokenization of payment methods, billing details, insurance, and overall form submission. It also supports saving a payment method for future use.

### Suported subcomponents

Required for checkout completion (add at least one):

- [justifi-card-form](/docs/modular-checkout-card-form--docs)
- [justifi-bank-account-form](/docs/modular-checkout-bank-account-form--docs)
- [justifi-saved-payment-methods](/docs/modular-checkout-saved-payment-methods--docs)
- [justifi-sezzle-payment-method](/docs/modular-checkout-sezzle-payment-method--docs)

Optional:

- [justifi-checkout-summary](/docs/modular-checkout-summary--docs)
- [justifi-insurance-form](/docs/modular-checkout-summary--docs)
- [justifi-billing-form](/docs/modular-checkout-billing-form--docs)
- [justifi-postal-code-form](/docs/modular-checkout-postal-code-form--docs)

> **Note:** In addition to the supported sub components, you can also include any custom HTML elements or markup inside the `checkout-wrapper`. This allows you to add headings, descriptions, disclaimers, or other layout elements as needed.

## Providing Billing Information

**For `justifi-card-form`:**

Billing information **is required** for checkout completion and can be provided in one of the following ways:

- Using the `<justifi-billing-form />` component

- Using the `<justifi-postal-form />` component

- Passing a `billingInformation` object directly to the `submitCheckout` method

The billingInformation object can take one of two forms:

**Full billing address:**

```javascript
{
  name: string;
  address_line1: string;
  address_line2?: string;
  address_city: string;
  address_state: string;
  address_postal_code: string;
}
```

**Only postal code:**

```javascript
{
  address_postal_code: string;
}
```

**For `<justifi-bank-account-form />`:**

Billing information **must be provided** through either:

- The `<justifi-billing-information-form />` component

- The full `billingInformation` object passed directly

## Completing Checkout

To finalize the checkout process, include a submit button that calls the `submitCheckout` method on the wrapper. This method.

- Handles validation, form submission and payment method tokenization.

- Optionally accepts a `billingInformation` object (useful when not using a billing component)

- Emits a `checkout-complete-event` when the submission is successful

- This method **does not** return a promise

> If you are using a new payment method and want to save it for future use, set the `savePaymentMethod` prop to `true` on the wrapper. This will automatically save the payment method after successful checkout.

## Validation

When `submitCheckout` is called, the wrapper automatically validates all included subcomponents. If any required fields are missing or invalid, submission is blocked and validation errors will appear inline.

You can also trigger validation manually by calling the `validate` method. This returns a promise that resolves to a `boolean` indicating whether the form is valid.

# Index

---

- [Props, events and methods](#props-events-and-methods)
- [Authorization](#authorization)
- [Events usage](#events-usage)
- [Example usage](#example-usage)

# Props, events and methods

---

<ArgTypes exclude={['Theme', 'slot']} />

# Authorization

---

<p>
  Authorization is performed by passing a web component token as{' '}
  <code>auth-token</code>.
</p>
<ul>
  <li>
    <strong>Web Component Token</strong>: These tokens are generated by your
    backend services using the [Web Component Tokens
    API](https://docs.justifi.tech/api-spec#tag/Web-Component-Tokens/operation/CreateWebComponentToken).
    Each token can be scoped to perform a set number of actions and is active
    for 60 minutes. When creating a web component token for this specific
    component you'll need to use the role: `read:account:account_id` or
    `write:account:account_id`. Make sure the value for `account_id` matches the
    prop you also pass separately.
  </li>
</ul>

# Example Usage

---

<ComponentBox>
  <justifi-checkout-wrapper
    account-id="acc_123"
    auth-token="123abc"
    checkout-id="cho_123"
    save-payment-method="true"
  >
    <justifi-card-form />
    <button
      id="submit-button"
      style={{
        marginTop: '30px',
        padding: '0px 30px',
        color: 'white',
        border: 'none',
        borderRadius: '5px',
      }}
    >
      Submit Checkout
    </button>
  </justifi-checkout-wrapper>
</ComponentBox>

---

<Source dark language="html" code={codeExample} />
```
