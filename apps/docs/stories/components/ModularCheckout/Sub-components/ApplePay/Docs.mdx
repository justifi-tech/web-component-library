import { Meta, Source } from '@storybook/blocks';
import {
  ComponentBox,
  Banner,
} from '../../../../utils/documentation-components';
import { setUpMocks } from '../../../../utils/mockAllServices';

{setUpMocks()}

<Meta
  title="Modular Checkout/Sub-components/Apple Pay"
  Components="justifi-apple-pay"
/>

# Apple Pay

---

Renders an Apple Pay button for eligible devices and orchestrates the Apple Pay flow. Designed to be used within `justifi-modular-checkout`.

## Props

<table>
  <thead>
    <tr>
      <th>Prop</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>countryCode</code></td>
      <td><code>string</code></td>
      <td><code>"US"</code></td>
      <td>ISO country code for the payment</td>
    </tr>
    <tr>
      <td><code>merchantIdentifier</code></td>
      <td><code>string</code></td>
      <td><code>"merchant.com.staging-justifi.checkout-dev"</code></td>
      <td>Apple Pay merchant ID registered with Apple</td>
    </tr>
    <tr>
      <td><code>merchantDisplayName</code></td>
      <td><code>string</code></td>
      <td><code>"JustiFi Checkout"</code></td>
      <td>Display name shown in Apple Pay sheet</td>
    </tr>
    <tr>
      <td><code>initiativeContext</code></td>
      <td><code>string</code></td>
      <td><code>"dev-checkout.justifi-staging.com"</code></td>
      <td>Initiative context domain for Apple Pay</td>
    </tr>
    <tr>
      <td><code>buttonType</code></td>
      <td><code>ApplePayButtonType</code></td>
      <td><code>PLAIN</code></td>
      <td>Button label type (<code>PLAIN</code>, <code>BUY</code>, <code>SET_UP</code>, <code>DONATE</code>, <code>CHECK_OUT</code>, <code>BOOK</code>, <code>SUBSCRIBE</code>)</td>
    </tr>
    <tr>
      <td><code>buttonStyle</code></td>
      <td><code>ApplePayButtonStyle</code></td>
      <td><code>BLACK</code></td>
      <td>Button color style (<code>BLACK</code>, <code>WHITE</code>, <code>WHITE_OUTLINE</code>)</td>
    </tr>
    <tr>
      <td><code>disabled</code></td>
      <td><code>boolean</code></td>
      <td><code>false</code></td>
      <td>Disable the Apple Pay button</td>
    </tr>
    <tr>
      <td><code>showSkeleton</code></td>
      <td><code>boolean</code></td>
      <td><code>true</code></td>
      <td>Show loading skeleton while initializing</td>
    </tr>
    <tr>
      <td><code>width</code></td>
      <td><code>string</code></td>
      <td><code>"100%"</code></td>
      <td>Button width</td>
    </tr>
    <tr>
      <td><code>height</code></td>
      <td><code>string</code></td>
      <td><code>"48px"</code></td>
      <td>Button height</td>
    </tr>
  </tbody>
</table>

## Events

- `applePayStarted`
- `applePayCompleted`
- `applePayCancelled`
- `applePayError`

### Event detail shapes

- `applePayCompleted`
  - Detail: `{ success: boolean; token?: IApplePayToken; paymentMethodId?: string; error?: any }`
- `applePayError`
  - Detail: `{ error: string; code: string }`
  - `code` values: `APPLE_PAY_CONFIG_ERROR`, `APPLE_PAY_NOT_SUPPORTED`, `APPLE_PAY_NOT_AVAILABLE`, `APPLE_PAY_INITIALIZATION_ERROR`, `APPLE_PAY_PAYMENT_FAILED`

### Listening for events

```ts
const applePay = document.querySelector('justifi-apple-pay');

applePay.addEventListener(
  'applePayError',
  (event: CustomEvent<{ error: string; code: string }>) => {
    console.error('Apple Pay error', event.detail.error, event.detail.code);
  }
);

applePay.addEventListener(
  'applePayCompleted',
  (event: CustomEvent<{ success: boolean; paymentMethodId?: string }>) => {
    if (event.detail.success) {
      console.log('Apple Pay tokenized', event.detail.paymentMethodId);
    }
  }
);
```

## Supported Browsers

- Safari 10.0+ (macOS)
- Safari 10.0+ (iOS)
- Chrome (iOS)
- Firefox (iOS)

> **Note:** Browser support for Apple Pay is determined by Apple's implementation and may vary based on device capabilities and Apple Pay availability in your region.
